<head>
  <title>incredible2</title>
</head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
  var conn;

  function sendKey(code, down) {
    if ((code >= 37 && code <= 40) || code == 32) {
      console.log(code)
      conn.send(JSON.stringify({Code: code, Down: down}))
      return false
    }
    return true
  }

  $(function() {

    $(document).bind('keydown', function (evt){
      if (sendKey(evt.keyCode, true)) {
        evt.preventDefault();
      }
    });

    $(document).bind('keyup', function (evt){
      if (sendKey(evt.keyCode, false)) {
        evt.preventDefault();
      }
    });

    function drawScreen(data) {
      var canvas = document.getElementById('screen');
      var ctx = canvas.getContext('2d');
      ctx.fillStyle="black";
      ctx.fillRect(0,0,640,480);

      for (i = 0; i < data.ships.length; ++i) {
        context.beginPath();
        context.arc(data.boxes[i].X, 640-data.boxes[i].Y, 5, 0, 2 * Math.PI, false);
        context.fillStyle = "green";
        context.fill();
        context.lineWidth = 5;
        context.strokeStyle = '#003300';
        context.stroke();	
      }
    }

    if (window["WebSocket"]) {
      conn = new WebSocket("ws://{{$}}/ws");
      conn.onclose = function(evt) {
        console.log("<div><b>Connection closed.</b></div>")
      }
      conn.onmessage = function(evt) {
        //        drawScreen(JSON.parse(evt.data));
        console.log(evt.data)
      }
    }
  });
</script>

<body>

  <canvas id="screen" width="640" height="480" style="width:100%; height: 100%"></canvas>
</body>
